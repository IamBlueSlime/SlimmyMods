subprojects {
    ext {
        modid = 'unknown'
    }

    sourceSets.main.resources { srcDir 'src/generated/resources' }

    afterEvaluate {
        minecraft {
            runs {
                client {
                    ideaModule "SlimmyMods.mods.${project.name}.main"

                    workingDirectory file('../run')
                    property 'forge.logging.markers', 'REGISTRIES'
                    property 'forge.logging.console.level', 'debug'

                    mods {
                        "${modid}" {
                            source sourceSets.main
                        }
                    }
                }

                server {
                    ideaModule "SlimmyMods.mods.${project.name}.main"

                    workingDirectory file('../run')
                    property 'forge.logging.markers', 'REGISTRIES'
                    property 'forge.logging.console.level', 'debug'

                    mods {
                        "${modid}" {
                            source sourceSets.main
                        }
                    }
                }

                data {
                    ideaModule "SlimmyMods.mods.${project.name}.main"

                    workingDirectory file('../run')
                    property 'forge.logging.markers', 'REGISTRIES'
                    property 'forge.logging.console.level', 'debug'
                    args '--mod', modid, '--all', '--output', file('src/generated/resources/'), '--existing', file('src/main/resources/')

                    mods {
                        "${modid}" {
                            source sourceSets.main
                        }
                    }
                }
            }
        }

        jar {
            manifest {
                attributes([
                        "Specification-Title": modid,
                        "Specification-Vendor": "IamBlueSlime",
                        "Specification-Version": "1",
                        "Implementation-Title": project.name,
                        "Implementation-Version": project.jar.archiveVersion,
                        "Implementation-Vendor": "IamBlueSlime",
                        "Implementation-Timestamp": new Date().format("yyyy-MM-dd'T'HH:mm:ssZ")
                ])
            }
        }

        jar.finalizedBy('reobfJar')
    }
}
